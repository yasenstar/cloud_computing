# 08 课程介绍

介绍云上基础设施的安全问题和如何处理

四个课程目标：

1. 了解云上基础安全威胁
2. 熟悉服务器安全管理的原理和不同方式
3. 熟悉网络安全管理的原理和不同方式
4. 熟悉如何用阿里云产品进行云上基础安全防护（安骑士）

# 09 云上基础安全防护内容简介

Base on Aliyun Security Architecture

- 南北向：互联网到业务
- 东西向：业务到业务

# 10 服务器安全管理123

云上主要基础安全威胁：

1. 主机威胁：挖坑病毒、感染型病毒、木马程序是2019年企业面临的主要主机安全威胁，挖坑病毒已经取代勒索病毒成为主要威胁，但是勒索病毒的影响还是很大的，
   - 例如熊猫烧香病毒，2017/05/12蠕虫型病毒WannaCry利用“永恒之蓝”即Windows开放的445端口以勒索为目的
   - 2020年上半年利用“新冠病毒”邮件传播的LemonDuck挖坑病毒和“黑球”攻击尤为值得关注
2. 主机漏洞：如远程代码执行、容器逃逸漏洞、远程拒绝服务
   - 例如Xen高危漏洞XSA-123
   - Venom Vulnerability毒液漏洞
3. 网站威胁：DDoS攻击和Web应用攻击都是互联网安全的主要威胁
   - DDoS：UDP_Flood, Memcache反射放大攻击
   - Web攻击
4. 安全基线：主机安全基线的定期检查，主要对OS、数据库、中间件的身份鉴别、访问控制、服务配置、安全审计、入侵防范等基础安全配置以及登录弱口令进行风险检查
   - 操作系统配置弱点
   - 中间件配置弱点
   - 公网开放
   - 弱密码

# 11 使用云安全中心高级版（安骑士）进行主机安全防护

安骑士是SaaS化的主机安全加固产品，主要功能为：

- 安全预防
- 入侵检测
- 精准防御
- 资产指纹

## 安全预防

漏洞管理：Linux, Windows, Web-CMS （每隔一天自动检测）

基线检查：账号安全检测，系统配置检测，数据库风险检测，合规对标检测 （检测周期可以自定义）

## 入侵检测

1. 异常登录：对非常用登录地点、非白名单登录事件、非法登录时间、非法账号、对暴力密码破解的防御
2. 网站后面查杀：本地+云查杀
3. 主机异常
4. 敏感数据篡改
5. 异常账号

## 精准防御

## 资产指纹

- 端口监听：清点每小时一次的端口开放信息
- 进程管理：检测异常进程，如挖坑进程
- 软件版本管理：清点软件的安装信息
- 账号信息：防止恶意提权

# 12 使用云安全中心高级版（安骑士）修复常见漏洞

## 漏洞常见的类型

系统漏洞

应用漏洞：常见的WEB漏洞有SQL注入，XSS漏洞，上传漏洞等

## 安骑士补丁管理

使用阿里云自研补丁修复漏洞。可共享阿里云安全漏洞应急响应，第一时间使用云盾自研补丁进行漏洞修复。时效性上优于官方发布补丁。

## 安骑士检测系统和应用漏洞

# 13 云助手

使用云助手批量管理多台服务器

安骑士的安全运维功能--云助手（没有费用）

- 上传并运行自动化运维脚本
- 运行实例上已有的脚本
- 管理软件生命周期
- 部署代码或者应用
- 轮询进程
- 安装补丁或安装安全更新
- 从OSS或YUM源获取更新
- 修改主机名或用户登录密码

运维常用命令：

1. 查看进程，按内存从大到小：`ps -e -o "%C:%z:%a"|sort -k5 -nr`
2. 查看进程，按CPU利用率从大到小排序：`ps -e -o "%C:%p:%z:%a"|sort -nr`
3. 查看剩余内存：`free -m | grep "Mem" | awk "{print $2}"`
4. 查看磁盘占用：`df -h`
5. 获取环境变量中path路径：`echo ${PATH}`

云助手工作原理：采用分布式Agent进行远程脚本执行

# 14 云安全中心安骑士及云助手演示

# 15 阿里云操作系统和镜像加固

阿里云自研的Aliyun Linux 2 OS已经经过了CIS的OSBenchmark

主机宕机迁移只能在同一地域的同一可用区内进行迁移，并且要把应用设置成自动重连的机制。

# 16 网络安全原理和常见网络安全问题

网络通信五元组：

1. 源IP
2. 源Port
3. 协议
4. 目标Port
5. 目标IP

常见网络安全问题：

- 广域网：监听、扫描、大流量、木马
- 城域网：黑客扫描、大流量攻击
- 接入网：ISP、IDC自身安全、规范
- 城域网间传输：明文传输容易被监听
- 城域网和接入网间传输：明文传输容易被监听
- 局域网：病毒、电子邮件、员工、系统bug、流程缺陷、管理漏洞

# 17 DDoS攻击介绍与防护措施

DDoS常见防护措施：

- 隐藏服务器IP
- 多节点加速
- 异常流量清洗
- 分布式集群防御
- 防火墙合理配置
- 专有抗D设备

# 18 网络防火墙的使用

阿里云通过安全组指定一个或多个防火墙规则，规则对加入了安全组的所有实例均生效。（每个实例至少要加入一个安全组）

两种安全组授权方式：

1. 指定源IP地址段(CIDR Block)
   ```
   100.100.0.0/16, protocol=tcp, port=0/65535, policy=accept, nictype=intranet
   ```
2. 指定源安全组的ID，只能用于内网间授权
   ```
   sg-002, protocol=tcp, port=0/65535, policy=accept, nictype=intranet
   ```

# 19 安全专有网络VPC

## VPC与经典网络

经典网络：
- IP地址由阿里云统一分配，配置简便，使用方便（IP唯一，不可变化，不可预测）
- 适合对操作易用性要求比较高、需要快速使用ECS的用户
- 同一租户默认完全互访
- 不同租户一般默认隔离

专有网络（私有网络VPC）：
- 指逻辑隔离的私有网络，可以自定义网络拓扑和IP地址，支持通过专线连接（IP VPC内唯一，可变化，可自定义，不同VPC间IP可重复）
- 适合于熟悉网络管理的用户
- 不同租户间私网隔离，安全性高
- 需要特殊策略实现VPC间安全互通

## VPC功能

- 自主可控的网络
  - 网络规划：IP地址规划，自定义路由，公网访问
  - 安全隔离：租户隔离，生产测试，访问控制
- 公网出入
  - 弹性公网IP（EIP）：可独立购买，可动态绑定到不同的ECS实例上，绑定和解绑时无需停机
  - 负载均衡
  - NAT网关
- 私网互联

# 20 阿里云DDoS防护

DDoS原生防护功能：

- 攻击流量的发现，牵引和自动处理
- 有效抵御各类基于网络层的DDoS攻击
- 大数据分析技术实现全自动检测和攻击策略的全自动匹配

接入DDoS高防的原因：

- 更强的服务能力
- 突破设备性能
- 突破机房带宽瓶颈，实现纵深防御

# 21 【实验】用安全组防勒索病毒

# 22 【实验】快速实现网站业务DDoS攻击的防护
